<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM de Prospecção - Silva Tintas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0A3D62"/>
    <link rel="apple-touch-icon" href="icon-192x192.png">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-nao-contatado { background-color: #e2e8f0; color: #4a5568; }
        .status-contatado { background-color: #bee3f8; color: #2b6cb0; }
        .status-em-negociacao { background-color: #faf089; color: #975a16; }
        .status-cliente { background-color: #c6f6d5; color: #2f855a; }
        .status-perdido { background-color: #fed7d7; color: #c53030; }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="app">
        <!-- Header -->
        <header class="bg-white shadow-md">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                     <div class="bg-[#0A3D62] p-2 rounded-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-[#0A3D62]">CRM de Prospecção</h1>
                </div>
                <button id="add-client-btn" class="bg-[#0A3D62] text-white font-semibold py-2 px-4 rounded-md hover:bg-[#1E90FF] transition text-sm flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    <span class="hidden sm:inline">Adicionar Cliente</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Dashboard Stats -->
            <section id="dashboard" class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                <!-- Stats will be rendered here by JS -->
            </section>

            <!-- Filters and Search -->
            <section class="mb-6 bg-white p-4 rounded-lg shadow-sm">
                <div class="grid md:grid-cols-3 gap-4 items-center">
                    <div class="md:col-span-2">
                        <label for="search" class="sr-only">Buscar Cliente</label>
                        <input type="text" id="search" placeholder="Buscar por nome do cliente..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#0A3D62] focus:border-transparent">
                    </div>
                    <div>
                        <label for="filter-segment" class="sr-only">Filtrar por Segmento</label>
                        <select id="filter-segment" class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-[#0A3D62] focus:border-transparent">
                            <option value="todos">Todos os Segmentos</option>
                            <option value="Reparação Automotiva">Reparação Automotiva</option>
                            <option value="Frotas e Veículos Pesados">Frotas e Veículos Pesados</option>
                            <option value="Indústria da Madeira e Mobiliário">Indústria da Madeira</option>
                            <option value="Indústria Metalmecânica e Construção">Indústria e Construção</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Client Table -->
            <section class="bg-white rounded-lg shadow-sm overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wider">Cliente</th>
                            <th class="px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wider">Segmento</th>
                            <th class="px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-xs font-bold text-gray-600 uppercase tracking-wider text-right">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="client-table-body">
                        <!-- Client rows will be rendered here by JS -->
                    </tbody>
                </table>
                 <div id="no-results" class="hidden text-center py-12 px-6">
                    <p class="text-gray-500">Nenhum cliente encontrado com os filtros aplicados.</p>
                </div>
            </section>
        </main>

        <!-- Modal for Client Details -->
        <div id="client-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
            <div id="modal-content" class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 opacity-0">
                <!-- Modal content will be rendered here by JS -->
            </div>
        </div>
        
        <!-- Modal for Adding a New Client -->
        <div id="add-client-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
            <div id="add-modal-content" class="bg-white rounded-lg shadow-2xl w-full max-w-lg transform scale-95 opacity-0">
                <form id="add-client-form" class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-900">Adicionar Novo Cliente</h2>
                        <button type="button" id="cancel-add-btn" class="p-1 rounded-full hover:bg-gray-200">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="new-client-name" class="block text-sm font-medium text-gray-700">Nome do Cliente</label>
                            <input type="text" id="new-client-name" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label for="new-client-address" class="block text-sm font-medium text-gray-700">Endereço</label>
                            <input type="text" id="new-client-address" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="new-client-contact" class="block text-sm font-medium text-gray-700">Contato (Telefone/Email)</label>
                            <input type="text" id="new-client-contact" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="new-client-segment" class="block text-sm font-medium text-gray-700">Segmento</label>
                            <select id="new-client-segment" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md bg-white">
                                <option value="Reparação Automotiva">Reparação Automotiva</option>
                                <option value="Frotas e Veículos Pesados">Frotas e Veículos Pesados</option>
                                <option value="Indústria da Madeira e Mobiliário">Indústria da Madeira</option>
                                <option value="Indústria Metalmecânica e Construção">Indústria e Construção</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6 flex justify-end">
                        <button type="submit" class="bg-[#0A3D62] text-white font-bold py-2 px-4 rounded-md hover:bg-[#1E90FF] transition">Salvar Cliente</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('Service Worker registrado com sucesso:', registration.scope);
                }, err => {
                    console.log('Falha no registro do Service Worker:', err);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const initialClients = [
                { id: 1, name: "Moreiras Funilaria e Pintura", address: "R. Dr. José Foz, 1522, Pres. Prudente", contact: "(18) 3903-4318", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 2, name: "Fernandes Funilaria e Pintura", address: "Av. Joaquim Constantino, 2691, Pres. Prudente", contact: "(18) 3905-1888", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 3, name: "Oficina Magnum", address: "R. Mendes de Moraes, 1375, Pres. Prudente", contact: "(18) 3903-1001", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 4, name: "Vanin Funilaria e Pintura", address: "Av. Pres. Juscelino Kubitschek, 8590, Pres. Prudente", contact: "(18) 3906-3838", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 5, name: "Auto Pinturas Presidente", address: "R. Dr. Gurgel, 1520, Pres. Prudente", contact: "(18) 3221-0988", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 6, name: "Stop Car Funilaria", address: "Av. Brasil, 2811, Pres. Prudente", contact: "(18) 3903-4004", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 7, name: "Liane Veículos (Funilaria)", address: "Av. Manoel Goulart, 3600, Pres. Prudente", contact: "(18) 2101-2101", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 8, name: "Autoeste Veículos (Chevrolet)", address: "Av. Manoel Goulart, 2350, Pres. Prudente", contact: "(18) 2104-5000", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 9, name: "Sector Veículos (Volkswagen)", address: "Av. Manoel Goulart, 3939, Pres. Prudente", contact: "(18) 3902-9555", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 10, name: "V. Muchiutt Veículos (Ford)", address: "Av. Manoel Goulart, 4000, Pres. Prudente", contact: "(18) 3918-9999", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 11, name: "Proeste (Fiat)", address: "Av. Manoel Goulart, 2651, Pres. Prudente", contact: "(18) 2101-8181", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 12, name: "T-Line (Toyota)", address: "Av. Manoel Goulart, 4351, Pres. Prudente", contact: "(18) 3902-9400", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 13, name: "Daitan (Honda)", address: "Av. Manoel Goulart, 3839, Pres. Prudente", contact: "(18) 3918-5800", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 14, name: "Nandin Sound e Acessórios", address: "Av. Brasil, 2505, Pres. Prudente", contact: "(18) 3903-5503", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 15, name: "Prudenparts Acessórios", address: "Av. Brasil, 1855, Pres. Prudente", contact: "(18) 3903-5500", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 16, name: "Impacto Rodas", address: "Av. Brasil, 1615, Pres. Prudente", contact: "(18) 3903-2223", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 17, name: "Polimentos e Estética Detail", address: "R. Ribeiro de Barros, 1848, Pres. Prudente", contact: "(18) 99745-5555", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 18, name: "Martelinho de Ouro Prudente", address: "Av. Washington Luiz, 2640, Pres. Prudente", contact: "(18) 3903-6666", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 19, name: "Garage 59 Customizações", address: "R. Dr. Gurgel, 550, Pres. Prudente", contact: "(18) 99709-5959", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 20, name: "Funilaria e Pintura Arte Car", address: "R. Euclides da Cunha, 1050, Dracena", contact: "(18) 3821-3000", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 21, name: "Funilaria Santa Rita", address: "R. Rui Barbosa, 1530, Santo Anastácio", contact: "(18) 3263-1444", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 22, name: "Beto Car Funilaria", address: "R. Alvino Gomes Teixeira, 1200, Pirapozinho", contact: "(18) 3269-1234", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 23, name: "Funilaria e Pintura do Alemão", address: "Av. Sete de Setembro, 850, Martinópolis", contact: "(18) 3275-1234", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 24, name: "Speed Car Funilaria", address: "R. Campos Sales, 123, Presidente Venceslau", contact: "(18) 3271-4567", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 25, name: "Adamantina Veículos (Funilaria)", address: "Alameda Fernão Dias, 300, Adamantina", contact: "(18) 3521-1234", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 26, name: "Funilaria e Pintura Modelo", address: "R. Quintino Bocaiúva, 789, Presidente Epitácio", contact: "(18) 3281-5678", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 27, name: "Centro de Pintura Automotiva", address: "Av. Coronel Marcondes, 4500, Pres. Prudente", contact: "(18) 3908-7890", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 28, name: "Art Final Pinturas", address: "R. Bela, 500, Pres. Prudente", contact: "(18) 3223-9876", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 29, name: "Stop Car Acessórios", address: "Av. Manoel Goulart, 1800, Pres. Prudente", contact: "(18) 3223-4567", segment: "Reparação Automotiva", status: "Não contatado", notes: [] },
                { id: 30, name: "Jandaia Transportes", address: "Rod. Raposo Tavares, S/N - Km 562, Pres. Prudente", contact: "(18) 3902-9000", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 31, name: "TNT Mercúrio Cargas", address: "R. Maria de Conceição, 110, Pres. Prudente", contact: "0800 979 6979", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 32, name: "Ativo Soluções e Logística", address: "Rod. Júlio Budisk, Km 5, Pres. Prudente", contact: "(18) 3909-6900", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 33, name: "Transportadora RodoNaves", address: "R. Prof.ª Sabelina de Campos, 350, Pres. Prudente", contact: "(18) 2101-9900", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 34, name: "Braspress Transportes", address: "R. Maria Fernandes, 250, Pres. Prudente", contact: "(18) 2101-8500", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 35, name: "Usina Alto Alegre", address: "Rod. PR-458, s/n, Santo Inácio (PR)", contact: "(44) 3352-8200", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 36, name: "Cocal Energia", address: "Rod. SP-425, km 423, Paraguaçu Paulista", contact: "(18) 3361-8800", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 37, name: "Raízen (Unidade Tarumã)", address: "Fazenda Maracaí, s/n, Tarumã", contact: "(18) 3373-9000", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 38, name: "Agroterenas", address: "Rod. SP-270, km 480, Paraguaçu Paulista", contact: "(18) 3361-9100", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 39, name: "Coopermota (Frota)", address: "Av. Coronel José Soares Marcondes, 3200, Pres. Prudente", contact: "(18) 3344-9300", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 40, name: "Gas-Oil Transportes", address: "Rod. Raposo Tavares, Km 580, Regente Feijó", contact: "(18) 3279-4400", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 41, name: "Transportadora JSL", address: "Av. Pres. Juscelino Kubitschek, 1000, Pres. Prudente", contact: "(18) 2101-7700", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 42, name: "Funada Transportes", address: "Av. Miguel Damha, 120, Pres. Prudente", contact: "(18) 3906-1234", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 43, name: "Transportadora Rápido Oeste", address: "R. da Imprensa, 500, Pres. Prudente", contact: "(18) 3903-5566", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 44, name: "TCPP - Transportes Coletivos", address: "R. Dr. Gurgel, 1191, Pres. Prudente", contact: "(18) 3903-4962", segment: "Frotas e Veículos Pesados", status: "Não contatado", notes: [] },
                { id: 45, name: "Marcenaria Oliveira Planejados", address: "R. Vinte e Oito, 145, Pres. Prudente", contact: "(18) 99753-4395", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 46, name: "Grupo RTW (Móveis Planejados)", address: "Av. da Saudade, 1355, Pres. Prudente", contact: "(18) 3905-1045", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 47, name: "Voltarelli Madeiras", address: "Av. Brasil, 3233, Pres. Prudente", contact: "(18) 3221-5588", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 48, name: "Marcenaria São José", address: "R. Casemiro Dias, 1435, Pres. Prudente", contact: "(18) 3221-4835", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 49, name: "Arte & Estilo Marcenaria", address: "R. Paulo Marcondes, 590, Pres. Prudente", contact: "(18) 3907-4228", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 50, name: "Móveis Planejados Italínea", address: "Av. Manoel Goulart, 1234, Pres. Prudente", contact: "(18) 3903-1020", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 51, name: "Todeschini Presidente Prudente", address: "Av. Washington Luiz, 2500, Pres. Prudente", contact: "(18) 3222-3344", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 52, name: "Marcenaria Irmãos Corazza", address: "R. José Claro, 456, Pres. Prudente", contact: "(18) 3223-5678", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 53, name: "Madeireira Frare", address: "Av. Brasil, 3500, Pres. Prudente", contact: "(18) 3221-9876", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 54, name: "Arq. Alexandre Dassa", address: "R. Dr. Gurgel, 1200, Pres. Prudente", contact: "contato@dassa.arq.br", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 55, name: "Arq. Carolina Viafora", address: "Av. Washington Luiz, 2000, Pres. Prudente", contact: "(18) 99700-1234", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 56, name: "Arq. Fernando Piffer", address: "R. Barão do Rio Branco, 800, Pres. Prudente", contact: "fernando@piffer.arq.br", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 57, name: "Marcenaria do Alemão", address: "R. da Saudade, 500, Presidente Venceslau", contact: "(18) 3271-9876", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 58, name: "Móveis Rústicos Martinópolis", address: "Av. do Comércio, 1500, Martinópolis", contact: "(18) 3275-5432", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 59, name: "Marcenaria Modelo", address: "R. das Flores, 300, Adamantina", contact: "(18) 3522-8765", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 60, name: "Dracena Móveis Planejados", address: "Av. dos Expedicionários, 2000, Dracena", contact: "(18) 3822-4567", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 61, name: "Marcenaria Santo Anastácio", address: "R. Brasil, 100, Santo Anastácio", contact: "(18) 3263-8765", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 62, name: "Pirapozinho Móveis", address: "Av. São Paulo, 900, Pirapozinho", contact: "(18) 3269-5432", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 63, name: "Marcenaria Qualitá", address: "R. Ribeiro de Barros, 2500, Pres. Prudente", contact: "(18) 3908-1234", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 64, name: "Dell Anno Móveis Planejados", address: "Av. Manoel Goulart, 2800, Pres. Prudente", contact: "(18) 3221-7654", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 65, name: "Madeireira Rio 42", address: "Rod. Raposo Tavares, km 560, Pres. Prudente", contact: "(18) 3906-4242", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 66, name: "Luthieria Prudente", address: "R. dos Músicos, 123, Pres. Prudente", contact: "(18) 99654-3210", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 67, name: "Artesanato em Madeira Vó Nena", address: "R. dos Artesãos, 45, Pres. Prudente", contact: "(18) 3223-8765", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 68, name: "F.A. Móveis Planejados", address: "R. Joaquim Nabuco, 800, Pres. Prudente", contact: "(18) 3903-9876", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 69, name: "Madeireira do Zé", address: "Av. da Saudade, 2000, Presidente Venceslau", contact: "(18) 3272-1234", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 70, name: "Arq. Leda Correia", address: "R. Siqueira Campos, 1500, Pres. Prudente", contact: "contato@ledacorreia.com.br", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 71, name: "Marcenaria Arte Nobre", address: "R. das Acácias, 150, Adamantina", contact: "(18) 3521-7654", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 72, name: "Carpintaria São Marcos", address: "R. dos Pinheiros, 70, Regente Feijó", contact: "(18) 3279-5432", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 73, name: "Decor House Móveis", address: "Av. Washington Luiz, 3000, Pres. Prudente", contact: "(18) 3916-7654", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 74, name: "Madeireira Cedro Rosa", address: "Av. Brasil, 4000, Dracena", contact: "(18) 3821-1234", segment: "Indústria da Madeira e Mobiliário", status: "Não contatado", notes: [] },
                { id: 75, name: "Serralheria Pai e Filho", address: "R. dos Expedicionários, 1260, Pres. Prudente", contact: "(18) 3905-2525", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 76, name: "Pruden-Aço Serralheria", address: "R. Inocêncio de Tarso, 20, Pres. Prudente", contact: "(18) 3907-2800", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 77, name: "Metalúrgica FREI", address: "R. Othmar Brand, 280, Pres. Prudente", contact: "(18) 3909-1055", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 78, name: "Constrix Construtora", address: "R. Dr. Gurgel, 1500, Pres. Prudente", contact: "contato@constrix.com.br", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 79, name: "Mampei Funada Construtora", address: "Av. Washington Luiz, 1370, Pres. Prudente", contact: "(18) 3229-1000", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 80, name: "Artenge Construções", address: "R. Barão do Rio Branco, 500, Pres. Prudente", contact: "(18) 3221-8765", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 81, name: "Serralheria São Francisco", address: "R. José Claro, 800, Pres. Prudente", contact: "(18) 3223-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 82, name: "Metalúrgica Prudente", address: "R. da Indústria, 100, Pres. Prudente", contact: "(18) 3909-8765", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 83, name: "Estruturas Metálicas Torres", address: "Av. Industrial, 500, Pres. Prudente", contact: "(18) 3909-1234", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 84, name: "Calhas e Rufos Prudente", address: "R. dos Seringueiros, 300, Pres. Prudente", contact: "(18) 3905-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 85, name: "Construtora W-A", address: "R. Siqueira Campos, 2000, Pres. Prudente", contact: "(18) 3222-9876", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 86, name: "Serralheria Venceslauense", address: "Av. Tiradentes, 800, Presidente Venceslau", contact: "(18) 3271-8765", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 87, name: "Metalúrgica Martinópolis", address: "R. do Comércio, 200, Martinópolis", contact: "(18) 3275-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 88, name: "Indústria de Máquinas Adamantina", address: "Av. da Saudade, 1500, Adamantina", contact: "(18) 3521-9876", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 89, name: "Construtora Dracena", address: "R. Monte Castelo, 500, Dracena", contact: "(18) 3821-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 90, name: "Serralheria do Povo", address: "Av. Brasil, 700, Santo Anastácio", contact: "(18) 3263-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 91, name: "Metalúrgica Pirapozinho", address: "R. da Indústria, 300, Pirapozinho", contact: "(18) 3269-8765", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 92, name: "Construtora Noroeste", address: "R. das Palmeiras, 100, Álvares Machado", contact: "(18) 3273-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 93, name: "Serralheria Art Metal", address: "R. Joaquim Nabuco, 1500, Pres. Prudente", contact: "(18) 3908-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 94, name: "Engemetal Estruturas", address: "Av. Juscelino Kubitschek, 10000, Pres. Prudente", contact: "(18) 3909-8765", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 95, name: "Construtora A. Gaspar", address: "R. Ribeiro de Barros, 1000, Pres. Prudente", contact: "(18) 3221-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 96, name: "Serralheria e Calhas São Judas", address: "R. da Paz, 50, Regente Feijó", contact: "(18) 3279-8765", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 97, name: "Metalúrgica Fundiart", address: "R. dos Metais, 200, Pres. Prudente", contact: "(18) 3909-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 98, name: "Construtora e Incorporadora Vértice", address: "Av. Manoel Goulart, 900, Pres. Prudente", contact: "(18) 3222-5432", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 99, name: "Prudenferro", address: "Av. Brasil, 2900, Pres. Prudente", contact: "(18) 3903-3344", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] },
                { id: 100, name: "Construtora Pacaembu", address: "Av. Manoel Goulart, 2400, Pres. Prudente", contact: "(18) 3916-8888", segment: "Indústria Metalmecânica e Construção", status: "Não contatado", notes: [] }
            ];

            let clients = JSON.parse(localStorage.getItem('crmClients')) || initialClients;

            const tableBody = document.getElementById('client-table-body');
            const searchInput = document.getElementById('search');
            const segmentFilter = document.getElementById('filter-segment');
            const dashboard = document.getElementById('dashboard');
            
            const clientModal = document.getElementById('client-modal');
            const clientModalContent = document.getElementById('modal-content');

            const addClientModal = document.getElementById('add-client-modal');
            const addClientModalContent = document.getElementById('add-modal-content');
            const addClientBtn = document.getElementById('add-client-btn');
            const addClientForm = document.getElementById('add-client-form');
            const cancelAddBtn = document.getElementById('cancel-add-btn');

            const noResultsDiv = document.getElementById('no-results');

            const statusClasses = {
                "Não contatado": "status-nao-contatado",
                "Contatado": "status-contatado",
                "Em negociação": "status-em-negociacao",
                "Cliente": "status-cliente",
                "Perdido": "status-perdido"
            };
            
            const statusOrder = {
                "Não contatado": 1,
                "Contatado": 2,
                "Em negociação": 3,
                "Cliente": 4,
                "Perdido": 5
            };

            const saveToLocalStorage = () => {
                localStorage.setItem('crmClients', JSON.stringify(clients));
            };

            const renderDashboard = () => {
                const total = clients.length;
                const naoContatado = clients.filter(c => c.status === 'Não contatado').length;
                const contatado = clients.filter(c => c.status === 'Contatado').length;
                const emNegociacao = clients.filter(c => c.status === 'Em negociação').length;
                const cliente = clients.filter(c => c.status === 'Cliente').length;
                
                dashboard.innerHTML = `
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                        <p class="text-2xl font-bold text-[#0A3D62]">${total}</p>
                        <p class="text-sm text-gray-500">Total de Leads</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                        <p class="text-2xl font-bold text-gray-600">${naoContatado}</p>
                        <p class="text-sm text-gray-500">Não Contatados</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                        <p class="text-2xl font-bold text-blue-600">${contatado}</p>
                        <p class="text-sm text-gray-500">Contatados</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                        <p class="text-2xl font-bold text-yellow-600">${emNegociacao}</p>
                        <p class="text-sm text-gray-500">Em Negociação</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm text-center">
                        <p class="text-2xl font-bold text-green-600">${cliente}</p>
                        <p class="text-sm text-gray-500">Clientes</p>
                    </div>
                `;
            };

            const renderTable = () => {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedSegment = segmentFilter.value;

                const filteredClients = clients.filter(client => {
                    const nameMatch = client.name.toLowerCase().includes(searchTerm);
                    const segmentMatch = selectedSegment === 'todos' || client.segment === selectedSegment;
                    return nameMatch && segmentMatch;
                });

                tableBody.innerHTML = '';
                
                if (filteredClients.length === 0) {
                    noResultsDiv.classList.remove('hidden');
                } else {
                    noResultsDiv.classList.add('hidden');
                }

                filteredClients
                    .sort((a, b) => statusOrder[a.status] - statusOrder[b.status] || a.name.localeCompare(b.name))
                    .forEach(client => {
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-200 hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">
                                <p class="font-semibold text-gray-900">${client.name}</p>
                                <p class="text-sm text-gray-500">${client.address.split(',').pop().trim()}</p>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${client.segment}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="status-badge ${statusClasses[client.status]}">${client.status}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right">
                                <button data-id="${client.id}" class="view-details-btn text-sm font-medium text-[#0A3D62] hover:text-[#1E90FF]">Detalhes</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
            };

            const openDetailsModal = (clientId) => {
                const client = clients.find(c => c.id === clientId);
                if (!client) return;

                clientModalContent.innerHTML = `
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900">${client.name}</h2>
                                <p class="text-sm text-gray-500">${client.address}</p>
                                <p class="text-sm text-gray-500">${client.contact}</p>
                            </div>
                            <button id="close-modal-btn" class="p-1 rounded-full hover:bg-gray-200">&times;</button>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="status-select" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <select id="status-select" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-white">
                                    <option value="Não contatado" ${client.status === 'Não contatado' ? 'selected' : ''}>Não contatado</option>
                                    <option value="Contatado" ${client.status === 'Contatado' ? 'selected' : ''}>Contatado</option>
                                    <option value="Em negociação" ${client.status === 'Em negociação' ? 'selected' : ''}>Em negociação</option>
                                    <option value="Cliente" ${client.status === 'Cliente' ? 'selected' : ''}>Cliente</option>
                                    <option value="Perdido" ${client.status === 'Perdido' ? 'selected' : ''}>Perdido</option>
                                </select>
                            </div>
                            <div class="self-end">
                                <button id="save-status-btn" class="w-full bg-[#0A3D62] text-white font-bold py-2 px-4 rounded-md hover:bg-[#1E90FF] transition">Salvar Alterações</button>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-2">Anotações</h3>
                            <div id="notes-container" class="space-y-3 mb-4 max-h-48 overflow-y-auto bg-gray-50 p-3 rounded-md">
                                ${client.notes.length > 0 ? client.notes.map(note => `
                                    <div class="text-sm border-b border-gray-200 pb-2">
                                        <p class="text-gray-700">${note.text}</p>
                                        <p class="text-xs text-gray-400 mt-1">${note.date}</p>
                                    </div>
                                `).join('') : '<p class="text-sm text-gray-400">Nenhuma anotação.</p>'}
                            </div>
                            <div class="flex gap-2">
                                <input type="text" id="new-note-input" placeholder="Adicionar nova anotação..." class="flex-grow px-3 py-2 border border-gray-300 rounded-md">
                                <button id="add-note-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-300 transition">Adicionar</button>
                            </div>
                        </div>
                    </div>
                `;

                clientModal.classList.remove('hidden');
                setTimeout(() => {
                    clientModalContent.classList.remove('scale-95', 'opacity-0');
                    clientModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);

                document.getElementById('close-modal-btn').addEventListener('click', closeDetailsModal);
                document.getElementById('save-status-btn').addEventListener('click', () => saveClientData(clientId));
                document.getElementById('add-note-btn').addEventListener('click', () => addNote(clientId));
            };

            const closeDetailsModal = () => {
                clientModalContent.classList.add('scale-95', 'opacity-0');
                clientModalContent.classList.remove('scale-100', 'opacity-100');
                setTimeout(() => {
                    clientModal.classList.add('hidden');
                }, 300);
            };
            
            const openAddModal = () => {
                addClientModal.classList.remove('hidden');
                setTimeout(() => {
                    addClientModalContent.classList.remove('scale-95', 'opacity-0');
                    addClientModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            };

            const closeAddModal = () => {
                addClientForm.reset();
                addClientModalContent.classList.add('scale-95', 'opacity-0');
                addClientModalContent.classList.remove('scale-100', 'opacity-100');
                setTimeout(() => {
                    addClientModal.classList.add('hidden');
                }, 300);
            };

            const saveClientData = (clientId) => {
                const client = clients.find(c => c.id === clientId);
                const statusSelect = document.getElementById('status-select');
                client.status = statusSelect.value;
                
                saveToLocalStorage();
                renderTable();
                renderDashboard();
                closeDetailsModal();
            };

            const addNote = (clientId) => {
                const client = clients.find(c => c.id === clientId);
                const noteInput = document.getElementById('new-note-input');
                const noteText = noteInput.value.trim();

                if (noteText) {
                    client.notes.unshift({
                        text: noteText,
                        date: new Date().toLocaleString('pt-BR')
                    });
                    noteInput.value = '';
                    saveToLocalStorage();
                    openDetailsModal(clientId); // Re-open to refresh notes
                }
            };
            
            const handleAddNewClient = (e) => {
                e.preventDefault();
                const name = document.getElementById('new-client-name').value.trim();
                if (!name) {
                    alert('O nome do cliente é obrigatório.');
                    return;
                }
                const newClient = {
                    id: Date.now(), // Simple unique ID
                    name: name,
                    address: document.getElementById('new-client-address').value,
                    contact: document.getElementById('new-client-contact').value,
                    segment: document.getElementById('new-client-segment').value,
                    status: 'Não contatado',
                    notes: []
                };
                clients.unshift(newClient);
                saveToLocalStorage();
                renderTable();
                renderDashboard();
                closeAddModal();
            };
            
            tableBody.addEventListener('click', (e) => {
                if (e.target.classList.contains('view-details-btn')) {
                    const clientId = parseInt(e.target.dataset.id, 10);
                    openDetailsModal(clientId);
                }
            });
            
            clientModal.addEventListener('click', (e) => {
                if (e.target.id === 'client-modal') {
                    closeDetailsModal();
                }
            });
            
            addClientBtn.addEventListener('click', openAddModal);
            cancelAddBtn.addEventListener('click', closeAddModal);
            addClientModal.addEventListener('click', (e) => {
                 if (e.target.id === 'add-client-modal') {
                    closeAddModal();
                }
            });
            addClientForm.addEventListener('submit', handleAddNewClient);

            searchInput.addEventListener('input', renderTable);
            segmentFilter.addEventListener('change', renderTable);

            // Initial render
            renderDashboard();
            renderTable();
        });
    </script>
</body>
</html>
