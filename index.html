<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calend√°rio de Conte√∫do Edit√°vel - Silva Tintas Automotivas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input {
            @apply block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
    <div id="loading-overlay" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="loading-spinner"></div>
        <p class="mt-4 text-gray-600">Carregando calend√°rio...</p>
    </div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Silva Tintas Automotivas</h1>
            <p class="text-lg text-gray-600 mt-2">Calend√°rio de Conte√∫do Edit√°vel</p>
        </header>

        <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
            <div id="calendar-header" class="flex items-center justify-between mb-4">
                <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <h2 id="month-year" class="text-xl sm:text-2xl font-semibold"></h2>
                <button id="next-month" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </button>
            </div>
            <div id="calendar-grid-header" class="grid calendar-grid gap-2 text-center font-medium text-gray-500 text-sm mb-2">
                <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
            </div>
            <div id="calendar-grid" class="grid calendar-grid gap-2"></div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl transform transition-all scale-95 opacity-0">
            <div class="flex items-center justify-between p-4 border-b border-gray-200">
                <h3 id="modal-title" class="text-xl font-semibold"></h3>
                <button id="close-modal" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="modal-content" class="p-6 overflow-y-auto max-h-[70vh] modal-content">
                <form id="content-form" class="space-y-6"></form>
            </div>
            <div id="modal-footer" class="p-4 bg-gray-50 border-t border-gray-200 rounded-b-2xl flex justify-end space-x-3"></div>
        </div>
    </div>

    <script type="module">
        // --- FIREBASE SETUP ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDPisgGzruxqnXzf9hPlb05uCN3hMozt2s",
            authDomain: "crm-silva-tintas.firebaseapp.com",
            projectId: "crm-silva-tintas",
            storageBucket: "crm-silva-tintas.firebasestorage.app",
            messagingSenderId: "37152653096",
            appId: "1:37152653096:web:7cf6864a5740ac94abda1d",
            measurementId: "G-KQ2N5EYNR5"
        };

        // Initialize Firebase and related services
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);
        
        // --- INITIAL DATA (for first-time setup) ---
        const initialContentData = {
            "9-1": { stories: { theme: "Domingo de Relax", description: "Conte√∫do leve e enquete sobre os projetos da semana." } },
            "9-2": { feed: { type: "Reel", brand: "Maxi Rubber", title: "Prepara√ß√£o √© Tudo!", description: "Reel acelerado mostrando a correta aplica√ß√£o e lixamento da massa poli√©ster da Maxi Rubber.", cta: "Uma base perfeita come√ßa aqui. Linha completa Maxi Rubber na nossa loja!" }, stories: { theme: "Segunda da T√©cnica", description: "Dica r√°pida sobre cat√°lise de massa." } },
            "9-3": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Caixa de perguntas sobre prepara√ß√£o de superf√≠cie." } },
            "9-4": { feed: { type: "Carrossel", brand: "Wanda", title: "Seu Tempo Vale Ouro", description: "Carrossel comparando o tempo de ciclo de um reparo r√°pido usando o sistema de secagem r√°pida da Wanda.", cta: "Mais carros por dia, mais lucro no fim do m√™s. Conhe√ßa as solu√ß√µes r√°pidas da Wanda!" }, stories: { theme: "Quarta do Cliente", description: "Mostrando um cliente buscando uma cor personalizada." } },
            "9-5": { stories: { theme: "Quinta de Bastidores", description: "Dia a dia na m√°quina de tintas." } },
            "9-6": { feed: { type: "Est√°tico", brand: "Sikkens", title: "A Escolha dos Campe√µes", description: "Foto de um carro de exposi√ß√£o ou de um restaurador parceiro, com men√ß√£o √† escolha pela linha Sikkens.", cta: "Quando o resultado precisa ser perfeito, a escolha √© Sikkens." }, stories: { theme: "Sexta do Projeto Finalizado", description: "Revela√ß√£o de um projeto de cliente." } },
            "9-7": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Feriado da Independ√™ncia. Posts com carros nas cores do Brasil." } },
            "9-8": { stories: { theme: "Domingo de Relax", description: "Enquete: qual o pr√≥ximo projeto?" } },
            "9-9": { feed: { type: "Reel", brand: "Montana Qu√≠mica", title: "Madeira Renovada", description: "Reel satisfat√≥rio de 'antes e depois' mostrando a aplica√ß√£o do Osmocolor Stain.", cta: "N√£o √© s√≥ para carros! Renove qualquer madeira com Montana." }, stories: { theme: "Segunda da T√©cnica", description: "Dica sobre como aplicar stain." } },
            "9-10": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Perguntas e respostas sobre vernizes para madeira." } },
            "9-11": { feed: { type: "Carrossel", brand: "Norton", title: "Qual Lixa Usar?", description: "Guia visual simples sobre a granula√ß√£o de lixas para cada etapa do processo.", cta: "A lixa certa faz toda a diferen√ßa. Salve este post e acerte na escolha!" }, stories: { theme: "Quarta do Cliente", description: "Cliente comprando lixas e discos." } },
            "9-12": { stories: { theme: "Quinta de Bastidores", description: "Organizando o estoque de abrasivos." } },
            "9-13": { feed: { type: "Reel", brand: "Todas", title: "Noite dos Cl√°ssicos", description: "V√≠deo com os melhores momentos de um encontro de carros local.", cta: "Adoramos fazer parte dessa paix√£o! Marque a gente no seu pr√≥ximo encontro!" }, stories: { theme: "Sexta do Projeto Finalizado", description: "V√≠deo com brilho de carro polido." } },
            "9-14": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Compartilhando fotos de carros de eventos locais." } },
            "9-15": { stories: { theme: "Domingo de Relax", description: "Planos para a semana." } },
            "9-16": { feed: { type: "Reel", brand: "Farben", title: "Aplica√ß√£o Sem Esfor√ßo", description: "V√≠deo mostrando a aplica√ß√£o suave e o excelente alastramento do Verniz Fast Dry da Farben.", cta: "Menos esfor√ßo, mais qualidade. Experimente a aplica√ß√£o dos vernizes Farben." }, stories: { theme: "Segunda da T√©cnica", description: "Dica de regulagem da pistola para verniz." } },
            "9-17": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Caixa de perguntas sobre aplica√ß√£o de verniz." } },
            "9-18": { feed: { type: "Est√°tico", brand: "Maxi Rubber", title: "Mascaramento Profissional", description: "Foto de um carro perfeitamente mascarado, com 3 dicas para um mascaramento sem falhas.", cta: "Evite o retrabalho. Temos fitas e materiais de mascaramento da mais alta qualidade." }, stories: { theme: "Quarta do Cliente", description: "Unboxing de fitas de mascaramento." } },
            "9-19": { stories: { theme: "Quinta de Bastidores", description: "Apresentando um membro da equipe." } },
            "9-20": { feed: { type: "Carrossel", brand: "Wanda", title: "Cores que Fizeram Hist√≥ria", description: "Carrossel com fotos de carros cl√°ssicos e suas cores ic√¥nicas.", cta: "Qual cor cl√°ssica √© a sua favorita? N√≥s fazemos na hora para o seu projeto!" }, stories: { theme: "Sexta do Projeto Finalizado", description: "Antes e depois de uma restaura√ß√£o." } },
            "9-21": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Fotos de carros customizados." } },
            "9-22": { stories: { theme: "Domingo de Relax", description: "Enquete sobre cores de carros." } },
            "9-23": { feed: { type: "Reel", brand: "Norton", title: "Vis√£o Cristalina", description: "Reel mostrando o processo completo de lixamento e polimento de um farol.", cta: "N√£o troque, recupere! Kit de polimento de far√≥is Norton dispon√≠vel." }, stories: { theme: "Segunda da T√©cnica", description: "Dica sobre prote√ß√£o UV para far√≥is." } },
            "9-24": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Perguntas sobre manuten√ß√£o de far√≥is." } },
            "9-25": { feed: { type: "Carrossel", brand: "Sikkens", title: "A Ci√™ncia por Tr√°s do Brilho", description: "Carrossel explicando a tecnologia dos vernizes Alto S√≥lidos da Sikkens.", cta: "Tecnologia que voc√™ v√™ no resultado final. Converse com nossos especialistas." }, stories: { theme: "Quarta do Cliente", description: "Cliente satisfeito com o resultado do verniz Sikkens." } },
            "9-26": { stories: { theme: "Quinta de Bastidores", description: "Mostrando o laborat√≥rio de cores." } },
            "9-27": { feed: { type: "Reel", brand: "Cliente", title: "Transforma√ß√£o da Semana", description: "Compilado de v√≠deos de um projeto de cliente, do in√≠cio ao fim.", cta: "Quer ver seu projeto aqui? Mande pra gente no direct!" }, stories: { theme: "Sexta do Projeto Finalizado", description: "V√≠deo de 'sextou com brilho'." } },
            "9-28": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Cobertura de evento local, se houver." } },
            "9-29": { stories: { theme: "Domingo de Relax", description: "Planejando a pr√≥xima semana." } },
            "9-30": { feed: { type: "Carrossel", brand: "Wanda/Farben", title: "Primer PU vs. Primer Universal", description: "Infogr√°fico comparando os benef√≠cios do Primer PU com um primer mais simples.", cta: "A base certa √© o segredo do sucesso. Escolha o primer ideal para cada reparo." }, stories: { theme: "Segunda da T√©cnica", description: "Dica sobre dilui√ß√£o de primer." } },
            "10-1": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Caixa de perguntas sobre primers e prepara√ß√£o." } },
            "10-2": { feed: { type: "Reel", brand: "Maxi Rubber", title: "Reparo de Pl√°stico? Sim!", description: "V√≠deo demonstrando a aplica√ß√£o do Veda-Choque da Maxi Rubber para reparar um para-choque trincado.", cta: "N√£o descarte, repare! Solu√ß√µes Maxi Rubber para pl√°sticos." }, stories: { theme: "Quarta do Cliente", description: "Cliente comprando produtos para reparo de pl√°stico." } },
            "10-3": { stories: { theme: "Quinta de Bastidores", description: "Recebendo mercadoria nova." } },
            "10-4": { feed: { type: "Est√°tico", brand: "Sikkens", title: "Acabamento de Prest√≠gio", description: "Foto de alta resolu√ß√£o de um carro de luxo, destacando a perfei√ß√£o da pintura. Legenda sobre a reputa√ß√£o da Sikkens em acabamentos premium.", cta: "Para projetos que exigem o melhor, exija Sikkens." }, stories: { theme: "Sexta do Projeto Finalizado", description: "Revela√ß√£o de um carro de alto padr√£o." } },
            "10-5": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Carros ex√≥ticos e superesportivos." } },
            "10-6": { stories: { theme: "Domingo de Relax", description: "Enquete: qual supercarro voc√™ teria?" } },
            "10-7": { feed: { type: "Reel", brand: "Norton", title: "Corte R√°pido, Acabamento Fino", description: "V√≠deo satisfat√≥rio mostrando um disco de lixa da Norton removendo material rapidamente, mas deixando uma superf√≠cie uniforme.", cta: "Efici√™ncia e qualidade no lixamento. Conhe√ßa a linha de abrasivos Norton." }, stories: { theme: "Segunda da T√©cnica", description: "Dica de como n√£o marcar a pe√ßa ao lixar." } },
            "10-8": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Perguntas sobre lixamento e prepara√ß√£o." } },
            "10-9": { feed: { type: "Carrossel", brand: "Wanda", title: "Prote√ß√£o Anticorrosiva", description: "Carrossel explicando a import√¢ncia do wash primer e dos primers fosfatizantes da Wanda na prote√ß√£o da chapa nua.", cta: "Proteja seu trabalho desde o in√≠cio. Linha completa de primers Wanda." }, stories: { theme: "Quarta do Cliente", description: "Cliente buscando solu√ß√£o para ferrugem." } },
            "10-10": { stories: { theme: "Quinta de Bastidores", description: "Demonstra√ß√£o de produto para a equipe." } },
            "10-11": { feed: { type: "Reel", brand: "Todas", title: "O Som da Oficina", description: "Reel com √°udio ASMR: o som da lixadeira, da pistola de pintura, do polimento. Uma homenagem aos profissionais.", cta: "Respeito m√°ximo por quem faz a m√°gica acontecer. #ProfissionalDaRepintura" }, stories: { theme: "Sexta do Projeto Finalizado", description: "Projeto finalizado com som ambiente." } },
            "10-12": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Feriado. Conte√∫do leve sobre carros e fam√≠lia." } },
            "10-13": { stories: { theme: "Domingo de Relax", description: "Planos para a semana." } },
            "10-14": { feed: { type: "Reel", brand: "Montana Qu√≠mica", title: "Deck como Novo!", description: "V√≠deo timelapse da restaura√ß√£o de um deck de madeira usando produtos da Montana, do lixamento √† aplica√ß√£o do verniz.", cta: "Sua √°rea externa merece esse cuidado. Linha completa Montana para decks e jardins." }, stories: { theme: "Segunda da T√©cnica", description: "Dica sobre manuten√ß√£o de decks." } },
            "10-15": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Perguntas sobre produtos para √°rea externa." } },
            "10-16": { feed: { type: "Est√°tico", brand: "Farben", title: "Tinta Poli√©ster: Cores Vibrantes", description: "Imagem com uma paleta de cores vibrantes, destacando a qualidade e a variedade da base poli√©ster da Farben.", cta: "A cor dos seus sonhos est√° aqui. Sistema tintom√©trico Farben com milhares de op√ß√µes." }, stories: { theme: "Quarta do Cliente", description: "Cliente escolhendo uma cor vibrante no leque." } },
            "10-17": { stories: { theme: "Quinta de Bastidores", description: "Manuten√ß√£o da m√°quina de tintas." } },
            "10-18": { feed: { type: "Carrossel", brand: "Maxi Rubber", title: "Guia de Produtos Maxi Rubber", description: "Carrossel 'Este ou Aquele?' comparando produtos da Maxi Rubber para diferentes situa√ß√µes (ex: Massa Poli√©ster vs. Massa para Pl√°stico).", cta: "Tem uma solu√ß√£o para cada necessidade. Salve este guia e consulte sempre!" }, stories: { theme: "Sexta do Projeto Finalizado", description: "Antes e depois de um reparo complexo." } },
            "10-19": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Projetos de customiza√ß√£o e personaliza√ß√£o." } },
            "10-20": { stories: { theme: "Domingo de Relax", description: "Enquete: qual customiza√ß√£o voc√™ faria no seu carro?" } },
            "10-21": { feed: { type: "Reel", brand: "Sikkens", title: "O Teste do Reflexo", description: "V√≠deo em close-up mostrando um objeto (como o logo da Sikkens) refletido com nitidez total em uma pe√ßa envernizada com Autoclear.", cta: "O verdadeiro teste da qualidade est√° no reflexo. Acabamento espelhado √© com Sikkens." }, stories: { theme: "Segunda da T√©cnica", description: "Dica para evitar 'casca de laranja'." } },
            "10-22": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Perguntas sobre aplica√ß√£o de verniz e polimento." } },
            "10-23": { feed: { type: "Carrossel", brand: "Norton", title: "Seguran√ßa em Primeiro Lugar", description: "Carrossel destacando a linha de EPIs da Norton (m√°scaras, luvas, √≥culos), com dicas de seguran√ßa para o pintor.", cta: "Trabalhe com paix√£o, mas sempre com seguran√ßa. Linha completa de EPIs Norton." }, stories: { theme: "Quarta do Cliente", description: "Cliente comprando kit de seguran√ßa." } },
            "10-24": { stories: { theme: "Quinta de Bastidores", description: "Treinamento de seguran√ßa com a equipe." } },
            "10-25": { feed: { type: "Reel", brand: "Cliente", title: "Do Rascunho √† Realidade", description: "Reel mostrando um projeto de restaura√ß√£o de um cliente, desde fotos antigas at√© o resultado final brilhando.", cta: "Hist√≥rias que nos inspiram. Obrigado por nos deixar fazer parte da sua!" }, stories: { theme: "Sexta do Projeto Finalizado", description: "Depoimento em v√≠deo de um cliente satisfeito." } },
            "10-26": { stories: { theme: "S√°bado de Inspira√ß√£o", description: "Visitando uma oficina parceira." } },
            "10-27": { stories: { theme: "Domingo de Relax", description: "Planejando os √∫ltimos dias do m√™s." } },
            "10-28": { feed: { type: "Reel", brand: "Wanda", title: "Acerto de Cor na Pr√°tica", description: "V√≠deo mostrando o uso do espectrofot√¥metro da Wanda em um carro, a f√≥rmula aparecendo no computador e a tinta sendo feita na hora.", cta: "Tecnologia a servi√ßo da perfei√ß√£o. Acerto de cor garantido." }, stories: { theme: "Segunda da T√©cnica", description: "Dica sobre como fazer o 'test-drive' da cor." } },
            "10-29": { stories: { theme: "Ter√ßa Tira-D√∫vidas", description: "Perguntas sobre colorimetria." } },
            "10-30": { feed: { type: "Carrossel", brand: "Todas", title: "Seu Kit Essencial", description: "Carrossel mostrando 'kits' para diferentes perfis: Kit do Restaurador (Sikkens, Wanda), Kit do Produtivo (Farben, Norton), Kit do Detailer (Norton).", cta: "Qual kit √© o seu? Montamos na hora para voc√™!" }, stories: { theme: "Quarta do Cliente", description: "Cliente montando um kit personalizado." } },
            "10-31": { stories: { theme: "Quinta de Bastidores", description: "Preparando a loja para o pr√≥ximo m√™s." } },
        };

        // --- GLOBAL VARIABLES ---
        let contentData = {};
        const calendarGrid = document.getElementById('calendar-grid');
        const monthYearEl = document.getElementById('month-year');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const modal = document.getElementById('modal');
        const modalContainer = modal.querySelector('div');
        const modalTitle = document.getElementById('modal-title');
        const modalFooter = document.getElementById('modal-footer');
        const contentForm = document.getElementById('content-form');
        const closeModalBtn = document.getElementById('close-modal');
        const loadingOverlay = document.getElementById('loading-overlay');

        let currentDate = new Date();
        currentDate.setDate(1);
        let selectedDayKey = null;

        // --- DATA HANDLING ---
        async function initializeAppLogic() {
            try {
                await signInAnonymously(auth);
                const docRef = doc(db, "calendars", "silva-tintas-content");
                
                // Real-time listener
                onSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists() && Object.keys(docSnap.data()).length > 0) {
                        contentData = docSnap.data();
                    } else {
                        console.log("No document found or it's empty! Creating one with initial data.");
                        contentData = initialContentData;
                        setDoc(docRef, contentData); // First time setup
                    }
                    renderCalendar();
                    loadingOverlay.style.display = 'none';
                });

            } catch (error) {
                console.error("Error initializing app:", error);
                loadingOverlay.innerHTML = '<p class="text-red-500">Erro ao carregar dados. Tente recarregar a p√°gina.</p>';
            }
        }

        // --- CALENDAR LOGIC ---
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            monthYearEl.textContent = `${currentDate.toLocaleString('pt-BR', { month: 'long' })} de ${year}`;
            calendarGrid.innerHTML = '';
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const lastDateOfMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarGrid.innerHTML += '<div class="border border-gray-200 rounded-lg"></div>';
            }

            for (let day = 1; day <= lastDateOfMonth; day++) {
                const dayKey = `${month + 1}-${day}`;
                const dayEl = document.createElement('div');
                dayEl.className = 'border border-gray-200 rounded-lg p-2 h-28 sm:h-32 flex flex-col cursor-pointer hover:bg-blue-50 transition-colors relative';
                dayEl.dataset.dayKey = dayKey;
                dayEl.dataset.day = day;

                const dayNumber = document.createElement('span');
                dayNumber.className = 'font-semibold text-gray-700';
                dayNumber.textContent = day;
                dayEl.appendChild(dayNumber);
                
                const today = new Date();
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayNumber.classList.add('bg-blue-500', 'text-white', 'rounded-full', 'w-7', 'h-7', 'flex', 'items-center', 'justify-center');
                }

                const content = contentData[dayKey];
                if (content) {
                    const contentWrapper = document.createElement('div');
                    contentWrapper.className = 'mt-1 space-y-1 overflow-hidden text-xs';
                    if (content.feed && content.feed.title) {
                        const feedPill = document.createElement('div');
                        const type = content.feed.type || 'Est√°tico';
                        feedPill.className = `flex items-center p-1 rounded-md ${type === 'Reel' ? 'bg-purple-100 text-purple-800' : type === 'Carrossel' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`;
                        const icon = type === 'Reel' ? 'üé¨' : type === 'Carrossel' ? 'üìë' : 'üñºÔ∏è';
                        feedPill.innerHTML = `<span class="mr-1">${icon}</span> <span class="font-medium truncate">${content.feed.title}</span>`;
                        contentWrapper.appendChild(feedPill);
                    }
                    if(content.stories && content.stories.theme) {
                         const storiesPill = document.createElement('div');
                         storiesPill.className = 'flex items-center p-1 rounded-md bg-pink-100 text-pink-800';
                         storiesPill.innerHTML = `<span>üì±</span> <span class="ml-1 truncate">${content.stories.theme}</span>`;
                         contentWrapper.appendChild(storiesPill);
                    }
                    dayEl.appendChild(contentWrapper);
                }
                calendarGrid.appendChild(dayEl);
            }
        }
        
        function showModal(day, dayKey) {
            selectedDayKey = dayKey;
            const content = contentData[dayKey] || { feed: {}, stories: {} };
            const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
            modalTitle.textContent = `Editar Conte√∫do - ${date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long' })}`;
            
            contentForm.innerHTML = `
                <div>
                    <h4 class="text-lg font-bold text-pink-600 mb-2 border-b pb-2">üì± Conte√∫do dos Stories</h4>
                    <div class="space-y-4 pt-2">
                        <div><label for="stories-theme" class="form-label">Tema do Dia</label><input type="text" id="stories-theme" class="form-input" placeholder="Ex: Segunda da T√©cnica" value="${content.stories?.theme || ''}"></div>
                        <div><label for="stories-description" class="form-label">Descri√ß√£o dos Stories</label><textarea id="stories-description" rows="2" class="form-input" placeholder="Ex: Dica r√°pida em v√≠deo, enquete...">${content.stories?.description || ''}</textarea></div>
                    </div>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-purple-600 mb-2 border-b pb-2">üé¨ Conte√∫do do Feed</h4>
                    <div class="space-y-4 pt-2">
                         <div><label for="feed-title" class="form-label">T√≠tulo do Post</label><input type="text" id="feed-title" class="form-input" placeholder="Ex: O Segredo do Brilho Espelhado" value="${content.feed?.title || ''}"></div>
                         <div><label for="feed-type" class="form-label">Formato</label><select id="feed-type" class="form-input"><option value="Est√°tico" ${content.feed?.type === 'Est√°tico' ? 'selected' : ''}>Est√°tico</option><option value="Carrossel" ${content.feed?.type === 'Carrossel' ? 'selected' : ''}>Carrossel</option><option value="Reel" ${content.feed?.type === 'Reel' ? 'selected' : ''}>Reel</option></select></div>
                         <div><label for="feed-brand" class="form-label">Marca em Destaque</label><input type="text" id="feed-brand" class="form-input" placeholder="Ex: Norton" value="${content.feed?.brand || ''}"></div>
                         <div><label for="feed-description" class="form-label">Descri√ß√£o do Post</label><textarea id="feed-description" rows="3" class="form-input" placeholder="Detalhes do que ser√° mostrado no post...">${content.feed?.description || ''}</textarea></div>
                         <div><label for="feed-cta" class="form-label">Chamada para A√ß√£o (CTA)</label><input type="text" id="feed-cta" class="form-input" placeholder="Ex: Visite nossa loja!" value="${content.feed?.cta || ''}"></div>
                    </div>
                </div>
            `;
            
            modalFooter.innerHTML = `<button id="delete-btn" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none">Excluir</button><button id="save-btn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none">Salvar</button>`;
            document.getElementById('save-btn').addEventListener('click', saveContent);
            document.getElementById('delete-btn').addEventListener('click', deleteContent);

            modal.classList.remove('hidden');
            setTimeout(() => modalContainer.classList.remove('scale-95', 'opacity-0'), 10);
        }

        function hideModal() {
            modalContainer.classList.add('scale-95', 'opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        async function saveContent() {
            const newContent = {
                stories: {
                    theme: document.getElementById('stories-theme').value.trim(),
                    description: document.getElementById('stories-description').value.trim(),
                },
                feed: {
                    title: document.getElementById('feed-title').value.trim(),
                    type: document.getElementById('feed-type').value,
                    brand: document.getElementById('feed-brand').value.trim(),
                    description: document.getElementById('feed-description').value.trim(),
                    cta: document.getElementById('feed-cta').value.trim(),
                }
            };
            
            if (!newContent.stories.theme && !newContent.stories.description) delete newContent.stories;
            if (!newContent.feed.title && !newContent.feed.description) delete newContent.feed;

            const docRef = doc(db, "calendars", "silva-tintas-content");
            const updatedData = { ...contentData };

            if (Object.keys(newContent).length > 0) {
                updatedData[selectedDayKey] = newContent;
            } else {
                delete updatedData[selectedDayKey];
            }
            
            try {
                await setDoc(docRef, updatedData);
                hideModal();
            } catch (error) {
                console.error("Error saving content: ", error);
                alert("N√£o foi poss√≠vel salvar as altera√ß√µes. Verifique sua conex√£o.");
            }
        }

        async function deleteContent() {
            if (confirm('Tem certeza que deseja excluir todo o conte√∫do deste dia?')) {
                const docRef = doc(db, "calendars", "silva-tintas-content");
                const updatedData = { ...contentData };
                delete updatedData[selectedDayKey];
                try {
                    await setDoc(docRef, updatedData);
                    hideModal();
                } catch (error) {
                    console.error("Error deleting content: ", error);
                    alert("N√£o foi poss√≠vel excluir o conte√∫do. Verifique sua conex√£o.");
                }
            }
        }

        // --- EVENT LISTENERS ---
        prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
        nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });
        calendarGrid.addEventListener('click', (e) => {
            const dayCell = e.target.closest('[data-day-key]');
            if (dayCell) showModal(dayCell.dataset.day, dayCell.dataset.dayKey);
        });
        closeModalBtn.addEventListener('click', hideModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) hideModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !modal.classList.contains('hidden')) hideModal(); });

        // --- INITIALIZATION ---
        initializeAppLogic();
    </script>
</body>
</html>
